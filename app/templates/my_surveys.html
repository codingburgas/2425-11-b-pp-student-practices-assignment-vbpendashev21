
{% extends "base.html" %}
{% block title %}{{ '–ú–æ–∏—Ç–µ –∞–Ω–∫–µ—Ç–∏' if session.get('lang') != 'en' else 'My Surveys' }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>üìã {{ '–ú–æ–∏—Ç–µ –∞–Ω–∫–µ—Ç–Ω–∏ –æ—Ç–≥–æ–≤–æ—Ä–∏' if session.get('lang') != 'en' else 'My Survey Responses' }}</h2>

  <form method="GET" class="row g-3 mb-4">
    <div class="col-md-3">
      <label class="form-label">{{ '–£—Å–ª–æ–≤–∏–µ' if session.get('lang') != 'en' else 'Condition' }}</label>
      <select class="form-select" name="condition">
        <option value="">{{ '–í—Å–∏—á–∫–∏' if session.get('lang') != 'en' else 'All' }}</option>
        <option value="sunny">‚òÄÔ∏è –°–ª—ä–Ω—á–µ–≤–æ</option>
        <option value="rain">üåßÔ∏è –î—ä–∂–¥</option>
        <option value="snow">‚ùÑÔ∏è –°–Ω—è–≥</option>
      </select>
    </div>
    <div class="col-md-2">
      <label class="form-label">{{ '–ú–∏–Ω. —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞' }}</label>
      <input type="number" class="form-control" name="min_temp" step="0.1">
    </div>
    <div class="col-md-2">
      <label class="form-label">{{ '–ú–∞–∫—Å. —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞' }}</label>
      <input type="number" class="form-control" name="max_temp" step="0.1">
    </div>
    <div class="col-md-2 align-self-end">
      <button class="btn btn-outline-primary w-100" type="submit">{{ '–§–∏–ª—Ç—Ä–∏—Ä–∞–π' if session.get('lang') != 'en' else 'Filter' }}</button>
    </div>
  </form>

  {% if surveys %}
  <table class="table table-striped">
    <thead>
      <tr>
        <th>{{ '–î–∞—Ç–∞' if session.get('lang') != 'en' else 'Date' }}</th>
        <th>{{ '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C)' }}</th>
        <th>{{ '–£—Å–ª–æ–≤–∏–µ' }}</th>
        <th>{{ '–û–±–ª–µ–∫–ª–æ' }}</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for s in surveys %}
      <tr>
        <td>{{ s.timestamp.strftime('%d.%m.%Y %H:%M') }}</td>
        <td>{{ s.temperature }}</td>
        <td>{{ s.condition }}</td>
        <td>{{ s.outfit }}</td>
        <td>
          <form method="POST" action="{{ url_for('main.delete_survey', id=s.id) }}">
            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('–°–∏–≥—É—Ä–µ–Ω –ª–∏ —Å–∏?')">üóë</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <img src="{{ url_for('main.my_surveys_plot') }}" alt="–ì—Ä–∞—Ñ–∏–∫–∞" class="img-fluid mt-4">
  {% else %}
  <div class="alert alert-warning">{{ '–ê–Ω–∫–µ—Ç–Ω–∏ –¥–∞–Ω–Ω–∏ –Ω–µ —Å–∞ –Ω–∞–ª–∏—á–Ω–∏ ‚Äî –≥—Ä–∞—Ñ–∏–∫–∞ –Ω–µ –º–æ–∂–µ –¥–∞ –±—ä–¥–µ –ø–æ–∫–∞–∑–∞–Ω–∞.' if session.get('lang') != 'en' else 'Survey data not available ‚Äî chart cannot be displayed.' }}</div>
  {% endif %}
</div>
{% endblock %}
